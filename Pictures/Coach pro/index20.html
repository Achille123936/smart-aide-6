<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Boot Football - Gestion Intelligente</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2a6234 50%, #5d8c3e 100%);
            min-height: 100vh;
            color: #333;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 5%;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .logo {
            font-size: 1.4rem;
            font-weight: bold;
            background: linear-gradient(135deg, #1a472a, #5d8c3e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-menu {
            display: flex;
            gap: 1.5rem;
            list-style: none;
        }

        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.3s;
            font-size: 0.9rem;
        }

        .nav-menu a:hover {
            color: #1a472a;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #1a472a;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem 5%;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* API Setup */
        .api-section {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .api-section h2 {
            color: #1a472a;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .api-input-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 1rem 0;
        }

        .input-field {
            flex: 1;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
        }

        .input-field:focus {
            outline: none;
            border-color: #1a472a;
        }

        .btn {
            padding: 1rem;
            background: linear-gradient(135deg, #1a472a, #5d8c3e);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1rem;
            text-align: center;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(26, 71, 42, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: white;
            color: #1a472a;
            border: 2px solid #1a472a;
        }

        .btn-success {
            background: linear-gradient(135deg, #059669, #10b981);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc2626, #ef4444);
        }

        .btn-warning {
            background: linear-gradient(135deg, #d97706, #f59e0b);
        }

        .btn-info {
            background: linear-gradient(135deg, #0369a1, #0ea5e9);
        }

        .status-message {
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
        }

        /* Home Page */
        .hero {
            text-align: center;
            color: white;
            padding: 2rem 0;
        }

        .hero h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .dashboard-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
            transition: all 0.3s;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .card-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1a472a;
            margin-bottom: 0.5rem;
        }

        .card-label {
            color: #666;
            font-size: 1rem;
        }

        /* Inscription Joueurs */
        .form-container {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #1a472a;
        }

        /* Liste des Joueurs */
        .players-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .table-header {
            background: linear-gradient(135deg, #1a472a, #5d8c3e);
            color: white;
            padding: 1rem;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 0.8fr;
            gap: 0.5rem;
            font-weight: 600;
            min-width: 800px;
        }

        .table-row {
            padding: 1rem;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 0.8fr;
            gap: 0.5rem;
            border-bottom: 1px solid #e0e0e0;
            align-items: center;
            min-width: 800px;
        }

        .table-row:hover {
            background: #f8fff9;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        /* Statistiques Joueurs */
        .stats-section {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .skill-bars {
            margin-top: 1rem;
        }

        .skill-bar {
            margin-bottom: 1rem;
        }

        .skill-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .skill-name {
            font-weight: 600;
            color: #1a472a;
        }

        .skill-value {
            color: #666;
        }

        .skill-progress {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .skill-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #1a472a, #5d8c3e);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Matchs et Entra√Ænements */
        .matches-section {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .match-card {
            background: #f8fff9;
            padding: 1rem;
            border-radius: 10px;
            border-left: 4px solid #1a472a;
            margin-bottom: 1rem;
        }

        .match-header {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .match-result {
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: #1a472a;
            color: white;
            width: fit-content;
        }

        .match-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }

        /* Analyse IA */
        .analysis-section {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .analysis-result {
            background: #f8fff9;
            padding: 1rem;
            border-radius: 10px;
            border-left: 4px solid #1a472a;
            margin-top: 1rem;
            line-height: 1.6;
            font-size: 0.9rem;
        }

        .insight-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #10b981;
        }

        /* G√©n√©rateur d'Images Tactiques */
        .tactical-board {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .image-generation-container {
            width: 100%; 
            min-height: 300px; 
            background: #2a6234; 
            border-radius: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            overflow: hidden;
            margin-bottom: 1.5rem;
            border: 2px dashed #5d8c3e;
            position: relative;
        }

        .image-placeholder {
            color: #ccc; 
            text-align: center; 
            padding: 2rem;
        }

        .image-loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 71, 42, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
        }

        /* Chatbot */
        .chat-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 1rem;
            background: linear-gradient(135deg, #1a472a, #5d8c3e);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            gap: 0.5rem;
            max-width: 85%;
            animation: slideIn 0.3s;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #1a472a, #5d8c3e);
        }

        .message.user .message-avatar {
            background: #e8f5e8;
        }

        .message-content {
            padding: 0.8rem 1rem;
            border-radius: 15px;
            line-height: 1.6;
            font-size: 0.9rem;
        }

        .message.bot .message-content {
            background: #f0f0f0;
            color: #333;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #1a472a, #5d8c3e);
            color: white;
        }

        .typing-indicator {
            display: flex;
            gap: 0.5rem;
            padding: 0.8rem 1rem;
            background: #f0f0f0;
            border-radius: 15px;
            width: fit-content;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #1a472a;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        .chat-input-area {
            padding: 1rem;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            padding: 1.5rem;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1a472a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 1rem;
        }

        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 1rem;
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                z-index: 1000;
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
            
            .dashboard-card {
                padding: 1rem;
            }
            
            .card-icon {
                font-size: 2rem;
            }
            
            .card-value {
                font-size: 1.5rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .api-section, .form-container, .stats-section, .matches-section, .analysis-section, .stat-card, .tactical-board {
                padding: 1rem;
            }
            
            .btn {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
            
            .chat-container {
                height: 400px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .message-avatar {
                width: 30px;
                height: 30px;
                font-size: 1rem;
            }
            
            .message-content {
                padding: 0.6rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .match-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .image-generation-container {
                min-height: 250px;
            }
        }

        @media (max-width: 480px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .logo {
                font-size: 1.2rem;
            }
            
            .hero h1 {
                font-size: 1.5rem;
            }
            
            .api-input-group {
                gap: 0.8rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">Coach Boot Football</div>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
        <ul class="nav-menu" id="nav-menu">
            <li><a onclick="showPage('dashboard')">Tableau de Bord</a></li>
            <li><a onclick="showPage('players')">Gestion Joueurs</a></li>
            <li><a onclick="showPage('stats')">Statistiques</a></li>
            <li><a onclick="showPage('matches')">Matchs & Entra√Ænements</a></li>
            <li><a onclick="showPage('analysis')">Analyse Tactique IA</a></li>
            <li><a onclick="showPage('api-setup')">Configuration API</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Tableau de Bord -->
        <div id="dashboard" class="page active">
            <div class="hero">
                <h1>Coach Boot Football</h1>
                <p>Plateforme intelligente de gestion et d'analyse footballistique</p>
            </div>
            
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <div class="card-icon">üë•</div>
                    <div class="card-value" id="total-players">0</div>
                    <div class="card-label">Joueurs Inscrits</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-icon">‚öΩ</div>
                    <div class="card-value" id="total-matches">0</div>
                    <div class="card-label">Matchs Jou√©s</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-icon">ü•Ö</div>
                    <div class="card-value" id="total-goals">0</div>
                    <div class="card-label">Buts Marqu√©s</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-icon">‚≠ê</div>
                    <div class="card-value" id="best-player">-</div>
                    <div class="card-label">Meilleur Joueur</div>
                </div>
            </div>

            <div class="stats-grid" style="margin-top: 2rem;">
                <div class="stat-card">
                    <h3 style="color: #1a472a; margin-bottom: 1rem;">R√©partition par Poste</h3>
                    <div class="chart-placeholder" style="height: 150px; background: #f8fff9; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #666;">
                        Graphique des postes - Donn√©es dynamiques
                    </div>
                </div>
                
                <div class="stat-card">
                    <h3 style="color: #1a472a; margin-bottom: 1rem;">Performance d'√âquipe</h3>
                    <div class="chart-placeholder" style="height: 150px; background: #f8fff9; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #666;">
                        Graphique des performances - Donn√©es dynamiques
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion des Joueurs -->
        <div id="players" class="page">
            <h1 style="color: white; text-align: center; margin-bottom: 1.5rem;">Gestion des Joueurs</h1>
            
            <div class="form-container">
                <h2 style="color: #1a472a; margin-bottom: 1rem;">Inscrire un Nouveau Joueur</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nom</label>
                        <input type="text" id="player-lastname" class="input-field" placeholder="Mbapp√©">
                    </div>
                    <div class="form-group">
                        <label>Pr√©nom</label>
                        <input type="text" id="player-firstname" class="input-field" placeholder="Kylian">
                    </div>
                    <div class="form-group">
                        <label>Date de Naissance</label>
                        <input type="date" id="player-birthdate" class="input-field">
                    </div>
                    <div class="form-group">
                        <label>Poste</label>
                        <select id="player-position" class="input-field">
                            <option value="gardien">Gardien</option>
                            <option value="defenseur">D√©fenseur</option>
                            <option value="milieu">Milieu</option>
                            <option value="attaquant">Attaquant</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Num√©ro</label>
                        <input type="number" id="player-number" class="input-field" min="1" max="99" placeholder="7">
                    </div>
                    <div class="form-group">
                        <label>Pied Fort</label>
                        <select id="player-strongfoot" class="input-field">
                            <option value="droit">Droit</option>
                            <option value="gauche">Gauche</option>
                            <option value="ambidextre">Ambidextre</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-success" onclick="addPlayer()">Inscrire le Joueur</button>
            </div>

            <div class="players-table">
                <div class="table-header">
                    <div>Nom</div>
                    <div>Pr√©nom</div>
                    <div>Poste</div>
                    <div>Num√©ro</div>
                    <div>Pied Fort</div>
                    <div>Note Globale</div>
                    <div>Actions</div>
                </div>
                <div id="players-list">
                    <!-- Liste dynamique des joueurs -->
                </div>
            </div>
        </div>

        <!-- Statistiques -->
        <div id="stats" class="page">
            <h1 style="color: white; text-align: center; margin-bottom: 1.5rem;">Statistiques des Joueurs</h1>
            
            <div class="stats-section">
                <h2 style="color: #1a472a; margin-bottom: 1rem;">Comp√©tences Techniques</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Joueur</label>
                        <select id="stats-player" class="input-field" onchange="loadPlayerStats()">
                            <option value="">S√©lectionner un joueur</option>
                        </select>
                    </div>
                </div>
                
                <div id="player-skills">
                    <!-- Comp√©tences dynamiques du joueur -->
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3 style="color: #1a472a; margin-bottom: 1rem;">Top Buteurs</h3>
                    <div id="top-scorers">
                        <!-- Liste dynamique -->
                    </div>
                </div>
                
                <div class="stat-card">
                    <h3 style="color: #1a472a; margin-bottom: 1rem;">Top Passeurs</h3>
                    <div id="top-assists">
                        <!-- Liste dynamique -->
                    </div>
                </div>
            </div>

            <div class="stats-section">
                <h2 style="color: #1a472a; margin-bottom: 1rem;">Statistiques d'√âquipe</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="card-value" id="team-avg-goals">0.0</div>
                        <div class="card-label">Buts/Match</div>
                    </div>
                    <div class="stat-card">
                        <div class="card-value" id="team-avg-possession">0%</div>
                        <div class="card-label">Possession Moyenne</div>
                    </div>
                    <div class="stat-card">
                        <div class="card-value" id="team-win-rate">0%</div>
                        <div class="card-label">Taux de Victoire</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Matchs & Entra√Ænements -->
        <div id="matches" class="page">
            <h1 style="color: white; text-align: center; margin-bottom: 1.5rem;">Matchs & Entra√Ænements</h1>
            
            <div class="matches-section">
                <h2 style="color: #1a472a; margin-bottom: 1rem;">Nouveau Match</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Adversaire</label>
                        <input type="text" id="match-opponent" class="input-field" placeholder="Real Madrid">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="match-date" class="input-field">
                    </div>
                    <div class="form-group">
                        <label>Buts Marqu√©s</label>
                        <input type="number" id="match-goals-for" class="input-field" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Buts Encaisse√©s</label>
                        <input type="number" id="match-goals-against" class="input-field" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Possession (%)</label>
                        <input type="number" id="match-possession" class="input-field" min="0" max="100" value="50">
                    </div>
                </div>
                <button class="btn btn-success" onclick="addMatch()">Enregistrer le Match</button>
            </div>

            <div class="matches-section">
                <h2 style="color: #1a472a; margin-bottom: 1rem;">Historique des Matchs</h2>
                <div id="matches-history">
                    <!-- Historique dynamique -->
                </div>
            </div>

            <div class="matches-section">
                <h2 style="color: #1a472a; margin-bottom: 1rem;">Programme d'Entra√Ænement</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="training-date" class="input-field">
                    </div>
                    <div class="form-group">
                        <label>Type d'Entra√Ænement</label>
                        <select id="training-type" class="input-field">
                            <option value="technique">Technique</option>
                            <option value="tactique">Tactique</option>
                            <option value="physique">Physique</option>
                            <option value="strategy">Strat√©gie</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Dur√©e (minutes)</label>
                        <input type="number" id="training-duration" class="input-field" min="30" value="90">
                    </div>
                </div>
                <button class="btn btn-warning" onclick="addTraining()">Planifier l'Entra√Ænement</button>
            </div>
        </div>

        <!-- Analyse Tactique IA -->
        <div id="analysis" class="page">
            <h1 style="color: white; text-align: center; margin-bottom: 1.5rem;">Analyse Tactique IA</h1>
            
            <div class="analysis-section">
                <h2 style="color: #1a472a; margin-bottom: 1rem;">Analyse des Performances avec IA</h2>
                <p>L'IA analyse les donn√©es tactiques pour optimiser les strat√©gies d'√©quipe.</p>
                
                <div class="api-input-group">
                    <button class="btn btn-success" onclick="analyzeTactics()">Analyser la Tactique</button>
                    <button class="btn btn-secondary" onclick="generateLineup()">G√©n√©rer Composition</button>
                    <button class="btn btn-warning" onclick="analyzeOpponent()">Analyser Adversaire</button>
                </div>
                
                <div id="analysis-result" class="analysis-result" style="display: none;">
                    <!-- R√©sultats de l'analyse IA -->
                </div>
            </div>

            <!-- G√©n√©rateur d'Images Tactiques IA -->
            <div class="tactical-board">
                <h3 style="color: #1a472a; text-align: center; margin-bottom: 1rem;">üéØ G√©n√©rateur d'Images Tactiques IA</h3>
                
                <div class="analysis-section" style="margin-bottom: 1.5rem;">
                    <h4 style="color: #1a472a; margin-bottom: 1rem;">Cr√©er un Plan Tactique avec l'IA</h4>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Formation Tactique</label>
                            <select id="formation-select" class="input-field">
                                <option value="4-3-3">4-3-3 (Attaque)</option>
                                <option value="4-4-2">4-4-2 (Classique)</option>
                                <option value="4-2-3-1">4-2-3-1 (Moderne)</option>
                                <option value="3-5-2">3-5-2 (Contr√¥le)</option>
                                <option value="5-3-2">5-3-2 (D√©fensif)</option>
                                <option value="4-1-4-1">4-1-4-1 (Possession)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Style de Jeu</label>
                            <select id="style-select" class="input-field">
                                <option value="attacking">‚öΩ Attaque Pressante</option>
                                <option value="possession">üîÑ Jeu de Possession</option>
                                <option value="counter">üöÄ Contre-Attaque</option>
                                <option value="defensive">üõ°Ô∏è D√©fense Solide</option>
                                <option value="pressing">üéØ Pressing Haut</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Instructions Sp√©cifiques</label>
                            <textarea id="tactical-instructions" class="input-field" placeholder="Ex: Mouvements des attaquants, placement d√©fensif..." rows="3"></textarea>
                        </div>
                    </div>
                    
                    <div class="api-input-group">
                        <button class="btn btn-success" onclick="generateTacticalImage()">
                            üé® G√©n√©rer l'Image Tactique
                        </button>
                        <button class="btn btn-info" onclick="enhanceTacticalImage()">
                            ‚ú® Am√©liorer l'Image
                        </button>
                    </div>
                    
                    <div id="image-generation-status" class="status-message" style="display: none;"></div>
                </div>

                <!-- Zone d'affichage de l'image g√©n√©r√©e -->
                <div id="generated-image-container" class="image-generation-container">
                    
                    <img id="generated-tactical-image" src="" alt="Image tactique g√©n√©r√©e" style="
                        max-width: 100%; 
                        max-height: 100%;
                        display: none;">
                    
                    <div id="image-placeholder" class="image-placeholder">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üéØ</div>
                        <p>Image tactique g√©n√©r√©e par IA</p>
                        <small>Utilisez le g√©n√©rateur ci-dessus pour cr√©er votre plan</small>
                    </div>
                    
                    <!-- Overlay de chargement -->
                    <div id="image-loading" class="image-loading">
                        <div class="spinner" style="border-top-color: white; margin-bottom: 1rem;"></div>
                        <p>G√©n√©ration de l'image en cours...</p>
                    </div>
                </div>

                <!-- Outils pour l'image g√©n√©r√©e -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-bottom: 1rem;">
                    <button class="btn btn-small" onclick="downloadTacticalImage()">üíæ T√©l√©charger</button>
                    <button class="btn btn-small" onclick="analyzeTacticalImage()">üîç Analyser</button>
                    <button class="btn btn-small" onclick="regenerateTacticalImage()">üîÑ R√©g√©n√©rer</button>
                    <button class="btn btn-small" onclick="clearTacticalImage()" style="background: #dc2626;">üóëÔ∏è Effacer</button>
                </div>

                <!-- Informations sur l'image g√©n√©r√©e -->
                <div id="image-info" style="
                    background: #f8fff9;
                    padding: 1rem;
                    border-radius: 8px;
                    border-left: 4px solid #1a472a;
                    display: none;">
                    <h5 style="color: #1a472a; margin-bottom: 0.5rem;">üìä Informations Tactiques</h5>
                    <div id="tactical-details"></div>
                </div>
            </div>

            <div class="chat-container">
                <div class="chat-header">
                    <h2>ü§ñ Assistant Tactique IA</h2>
                </div>
                
                <div class="chat-messages" id="chat-messages">
                    <div class="message bot">
                        <div class="message-avatar">ü§ñ</div>
                        <div class="message-content">
                            Bonjour Coach ! Je suis votre assistant tactique. Je peux analyser les performances, sugg√©rer des strat√©gies et optimiser vos compositions d'√©quipe.
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="chat-input" placeholder="Posez votre question tactique..." onkeypress="handleChatInput(event)">
                    <button class="btn" onclick="sendMessage()">Envoyer</button>
                </div>
            </div>
        </div>

        <!-- Configuration API -->
        <div id="api-setup" class="page">
            <div class="api-section">
                <h2>Configuration de l'API OpenAI</h2>
                <p>Entrez votre cl√© API OpenAI pour activer l'analyse tactique intelligente.</p>
                
                <div class="api-input-group">
                    <input type="password" id="api-key" class="input-field" placeholder="sk-...">
                    <button class="btn" onclick="saveApiKey()">Sauvegarder</button>
                </div>
                
                <div class="api-input-group">
                    <button class="btn btn-secondary" onclick="testApiKey()">Tester la connexion</button>
                    <button class="btn btn-secondary" onclick="clearApiKey()">Effacer</button>
                </div>
                
                <div id="api-status" class="status-message" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuration API
        const API_KEY_STORAGE = 'openai_api_key';
        
        // Donn√©es de l'application
        let players = JSON.parse(localStorage.getItem('football_players')) || [];
        let matches = JSON.parse(localStorage.getItem('football_matches')) || [];
        let trainings = JSON.parse(localStorage.getItem('football_trainings')) || [];
        
        // Variables pour la g√©n√©ration d'images
        let currentGeneratedImage = null;
        let imageGenerationHistory = [];
        
        const positions = {
            'gardien': 'Gardien',
            'defenseur': 'D√©fenseur',
            'milieu': 'Milieu',
            'attaquant': 'Attaquant'
        };

        const skillsList = [
            'tir', 'passe', 'dribble', 'vitesse', 'endurance',
            'defense', 'tacle', 'tete', 'placement', 'vision'
        ];

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            loadPlayersList();
            loadPlayerSelect();
            loadMatchesHistory();
            updateTeamStats();
            
            const savedApiKey = localStorage.getItem(API_KEY_STORAGE);
            if (savedApiKey) {
                document.getElementById('api-key').value = savedApiKey;
            }
            
            console.log('Coach Boot Football initialis√© avec g√©n√©rateur d\'images IA');
        });

        // Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // Fermer le menu mobile
            const navMenu = document.getElementById('nav-menu');
            if (navMenu) {
                navMenu.classList.remove('active');
            }
            
            if (pageId === 'dashboard') loadDashboard();
            if (pageId === 'players') loadPlayersList();
            if (pageId === 'stats') {
                loadPlayerSelect();
                updateTeamStats();
            }
            if (pageId === 'matches') loadMatchesHistory();
        }

        function toggleMobileMenu() {
            const navMenu = document.getElementById('nav-menu');
            navMenu.classList.toggle('active');
        }

        // Gestion des joueurs
        function addPlayer() {
            const lastname = document.getElementById('player-lastname').value;
            const firstname = document.getElementById('player-firstname').value;
            const birthdate = document.getElementById('player-birthdate').value;
            const position = document.getElementById('player-position').value;
            const number = parseInt(document.getElementById('player-number').value);
            const strongfoot = document.getElementById('player-strongfoot').value;
            
            if (!lastname || !firstname || !birthdate || !number) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            // G√©n√©rer des comp√©tences al√©atoires pour la d√©mo
            const skills = {};
            skillsList.forEach(skill => {
                skills[skill] = Math.floor(Math.random() * 20) + 70; // 70-90
            });
            
            const player = {
                id: Date.now(),
                lastname: lastname.trim(),
                firstname: firstname.trim(),
                birthdate: birthdate,
                position: position,
                number: number,
                strongfoot: strongfoot,
                skills: skills,
                stats: {
                    matches: 0,
                    goals: 0,
                    assists: 0,
                    yellowCards: 0,
                    redCards: 0
                }
            };
            
            players.push(player);
            savePlayers();
            loadPlayersList();
            loadPlayerSelect();
            updateDashboard();
            
            // Reset form
            document.getElementById('player-lastname').value = '';
            document.getElementById('player-firstname').value = '';
            document.getElementById('player-birthdate').value = '';
            document.getElementById('player-number').value = '';
            
            showStatus('Joueur inscrit avec succ√®s!', 'success');
        }

        function deletePlayer(playerId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce joueur ?')) {
                players = players.filter(p => p.id !== playerId);
                savePlayers();
                loadPlayersList();
                loadPlayerSelect();
                updateDashboard();
                showStatus('Joueur supprim√© avec succ√®s', 'success');
            }
        }

        // Gestion des matchs
        function addMatch() {
            const opponent = document.getElementById('match-opponent').value;
            const date = document.getElementById('match-date').value;
            const goalsFor = parseInt(document.getElementById('match-goals-for').value);
            const goalsAgainst = parseInt(document.getElementById('match-goals-against').value);
            const possession = parseInt(document.getElementById('match-possession').value);
            
            if (!opponent || !date) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            const match = {
                id: Date.now(),
                opponent: opponent.trim(),
                date: date,
                goalsFor: goalsFor,
                goalsAgainst: goalsAgainst,
                possession: possession,
                result: goalsFor > goalsAgainst ? 'victoire' : goalsFor < goalsAgainst ? 'd√©faite' : 'nul'
            };
            
            matches.push(match);
            saveMatches();
            loadMatchesHistory();
            updateDashboard();
            updateTeamStats();
            
            // Reset form
            document.getElementById('match-opponent').value = '';
            document.getElementById('match-date').value = '';
            document.getElementById('match-goals-for').value = '0';
            document.getElementById('match-goals-against').value = '0';
            document.getElementById('match-possession').value = '50';
            
            showStatus('Match enregistr√© avec succ√®s!', 'success');
        }

        // Gestion des entra√Ænements
        function addTraining() {
            const date = document.getElementById('training-date').value;
            const type = document.getElementById('training-type').value;
            const duration = parseInt(document.getElementById('training-duration').value);
            
            if (!date) {
                alert('Veuillez s√©lectionner une date');
                return;
            }
            
            const training = {
                id: Date.now(),
                date: date,
                type: type,
                duration: duration
            };
            
            trainings.push(training);
            saveTrainings();
            showStatus('Entra√Ænement planifi√© avec succ√®s!', 'success');
        }

        // Calcul des statistiques
        function calculatePlayerOverall(player) {
            const skills = Object.values(player.skills);
            const average = skills.reduce((sum, skill) => sum + skill, 0) / skills.length;
            return Math.round(average);
        }

        // Affichage des donn√©es
        function loadDashboard() {
            updateDashboard();
        }

        function updateDashboard() {
            document.getElementById('total-players').textContent = players.length;
            document.getElementById('total-matches').textContent = matches.length;
            
            // Total des buts
            const totalGoals = matches.reduce((sum, match) => sum + match.goalsFor, 0);
            document.getElementById('total-goals').textContent = totalGoals;
            
            // Meilleur joueur
            let bestPlayer = null;
            let bestOverall = 0;
            
            players.forEach(player => {
                const overall = calculatePlayerOverall(player);
                if (overall > bestOverall) {
                    bestOverall = overall;
                    bestPlayer = player;
                }
            });
            
            document.getElementById('best-player').textContent = bestPlayer ? 
                `${bestPlayer.firstname} ${bestPlayer.lastname}` : '-';
        }

        function loadPlayersList() {
            const playersList = document.getElementById('players-list');
            let html = '';
            
            players.forEach(player => {
                const overall = calculatePlayerOverall(player);
                html += `
                    <div class="table-row">
                        <div>${player.lastname}</div>
                        <div>${player.firstname}</div>
                        <div>${positions[player.position]}</div>
                        <div>${player.number}</div>
                        <div>${player.strongfoot}</div>
                        <div>${overall}/100</div>
                        <div class="action-buttons">
                            <button class="btn btn-danger btn-small" onclick="deletePlayer(${player.id})">Supprimer</button>
                        </div>
                    </div>
                `;
            });
            
            playersList.innerHTML = html || '<div class="table-row"><div colspan="7" style="text-align: center; color: #666;">Aucun joueur inscrit</div></div>';
        }

        function loadPlayerSelect() {
            const select = document.getElementById('stats-player');
            let html = '<option value="">S√©lectionner un joueur</option>';
            
            players.forEach(player => {
                html += `<option value="${player.id}">${player.firstname} ${player.lastname} - ${positions[player.position]}</option>`;
            });
            
            select.innerHTML = html;
        }

        function loadPlayerStats() {
            const playerId = parseInt(document.getElementById('stats-player').value);
            if (!playerId) return;
            
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            
            const skillsDiv = document.getElementById('player-skills');
            let html = '<div class="skill-bars">';
            
            Object.entries(player.skills).forEach(([skill, value]) => {
                html += `
                    <div class="skill-bar">
                        <div class="skill-info">
                            <span class="skill-name">${skill.charAt(0).toUpperCase() + skill.slice(1)}</span>
                            <span class="skill-value">${value}/100</span>
                        </div>
                        <div class="skill-progress">
                            <div class="skill-progress-fill" style="width: ${value}%"></div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            skillsDiv.innerHTML = html;
            
            // Mettre √† jour les tops
            updateTopScorers();
            updateTopAssists();
        }

        function loadMatchesHistory() {
            const matchesDiv = document.getElementById('matches-history');
            let html = '';
            
            matches.slice(-5).reverse().forEach(match => {
                html += `
                    <div class="match-card">
                        <div class="match-header">
                            <div><strong>VS ${match.opponent}</strong> - ${match.date}</div>
                            <div class="match-result">${match.goalsFor} - ${match.goalsAgainst}</div>
                        </div>
                        <div class="match-details">
                            <div>Possession: ${match.possession}%</div>
                            <div>R√©sultat: ${match.result}</div>
                        </div>
                    </div>
                `;
            });
            
            matchesDiv.innerHTML = html || '<p style="text-align: center; color: #666;">Aucun match enregistr√©</p>';
        }

        function updateTeamStats() {
            // Buts par match
            const avgGoals = matches.length > 0 ? 
                (matches.reduce((sum, match) => sum + match.goalsFor, 0) / matches.length).toFixed(1) : '0.0';
            document.getElementById('team-avg-goals').textContent = avgGoals;
            
            // Possession moyenne
            const avgPossession = matches.length > 0 ? 
                Math.round(matches.reduce((sum, match) => sum + match.possession, 0) / matches.length) : 0;
            document.getElementById('team-avg-possession').textContent = avgPossession + '%';
            
            // Taux de victoire
            const wins = matches.filter(match => match.result === 'victoire').length;
            const winRate = matches.length > 0 ? Math.round((wins / matches.length) * 100) : 0;
            document.getElementById('team-win-rate').textContent = winRate + '%';
        }

        function updateTopScorers() {
            const topScorers = players
                .filter(p => p.stats.goals > 0)
                .sort((a, b) => b.stats.goals - a.stats.goals)
                .slice(0, 5);
            
            let html = '';
            topScorers.forEach((player, index) => {
                html += `<div style="padding: 0.5rem; border-bottom: 1px solid #eee;">${index + 1}. ${player.firstname} ${player.lastname} - ${player.stats.goals} buts</div>`;
            });
            document.getElementById('top-scorers').innerHTML = html || '<p>Aucun buteur</p>';
        }

        function updateTopAssists() {
            const topAssists = players
                .filter(p => p.stats.assists > 0)
                .sort((a, b) => b.stats.assists - a.stats.assists)
                .slice(0, 5);
            
            let html = '';
            topAssists.forEach((player, index) => {
                html += `<div style="padding: 0.5rem; border-bottom: 1px solid #eee;">${index + 1}. ${player.firstname} ${player.lastname} - ${player.stats.assists} passes d√©</div>`;
            });
            document.getElementById('top-assists').innerHTML = html || '<p>Aucune passe d√©</p>';
        }

        // Analyse IA
        async function analyzeTactics() {
            const apiKey = getApiKey();
            if (!apiKey) {
                showStatus('Veuillez configurer l\'API OpenAI d\'abord', 'error');
                return;
            }

            showStatus('Analyse tactique en cours...', 'success', 'analysis-result');
            document.getElementById('analysis-result').style.display = 'block';

            try {
                const analysisData = {
                    totalPlayers: players.length,
                    totalMatches: matches.length,
                    positions: players.reduce((acc, player) => {
                        acc[player.position] = (acc[player.position] || 0) + 1;
                        return acc;
                    }, {}),
                    recentResults: matches.slice(-5).map(match => ({
                        opponent: match.opponent,
                        result: match.result,
                        score: `${match.goalsFor}-${match.goalsAgainst}`
                    })),
                    teamStrengths: analyzeTeamStrengths()
                };

                const prompt = `Analyse les donn√©es footballistiques suivantes et fournis une analyse tactique d√©taill√©e:
                
                Donn√©es: ${JSON.stringify(analysisData, null, 2)}
                
                Fournis une analyse structur√©e avec:
                1. Points forts de l'√©quipe
                2. Faiblesses √† corriger
                3. Recommandations tactiques
                4. Strat√©gies de match`;

                const analysis = await callOpenAI([
                    { role: "user", content: prompt }
                ]);

                document.getElementById('analysis-result').innerHTML = `
                    <h4>‚öΩ Analyse Tactique de l'√âquipe</h4>
                    <div style="margin-top: 1rem;">${analysis.replace(/\n/g, '<br>')}</div>
                `;

            } catch (error) {
                document.getElementById('analysis-result').innerHTML = `
                    <p style="color: #dc2626;">Erreur lors de l'analyse: ${error.message}</p>
                `;
            }
        }

        async function generateLineup() {
            const apiKey = getApiKey();
            if (!apiKey) {
                showStatus('Veuillez configurer l\'API OpenAI d\'abord', 'error');
                return;
            }

            try {
                const playersData = players.map(player => ({
                    name: `${player.firstname} ${player.lastname}`,
                    position: player.position,
                    overall: calculatePlayerOverall(player),
                    skills: player.skills
                }));

                const prompt = `Sur la base des joueurs suivants, g√©n√®re la composition d'√©quipe optimale (4-3-3):
                
                Joueurs disponibles: ${JSON.stringify(playersData, null, 2)}
                
                Fournis une composition avec:
                - 1 gardien
                - 4 d√©fenseurs
                - 3 milieux
                - 3 attaquants
                - Justification des choix`;

                const lineup = await callOpenAI([
                    { role: "user", content: prompt }
                ]);

                const insightsDiv = document.getElementById('tactical-insights');
                insightsDiv.innerHTML = `
                    <div class="insight-item">
                        <h4>üéØ Composition Optimale G√©n√©r√©e</h4>
                        <div style="margin-top: 1rem;">${lineup.replace(/\n/g, '<br>')}</div>
                    </div>
                `;

            } catch (error) {
                showStatus('Erreur: ' + error.message, 'error');
            }
        }

        async function analyzeOpponent() {
            const apiKey = getApiKey();
            if (!apiKey) {
                showStatus('Veuillez configurer l\'API OpenAI d\'abord', 'error');
                return;
            }

            try {
                const opponent = document.getElementById('match-opponent').value || "l'adversaire";
                const recentMatches = matches.slice(-3);

                const prompt = `En tant qu'expert tactique, analyse comment affronter ${opponent} bas√© sur nos r√©cents matchs:
                
                Nos r√©cents matchs: ${JSON.stringify(recentMatches, null, 2)}
                
                Propose une strat√©gie pour le prochain match avec:
                1. Formation recommand√©e
                2. Points cl√©s √† exploiter
                3. Pi√®ges √† √©viter
                4. Joueurs cl√©s √† surveiller`;

                const analysis = await callOpenAI([
                    { role: "user", content: prompt }
                ]);

                const insightsDiv = document.getElementById('tactical-insights');
                insightsDiv.innerHTML = `
                    <div class="insight-item">
                        <h4>üîç Analyse de l'Adversaire: ${opponent}</h4>
                        <div style="margin-top: 1rem;">${analysis.replace(/\n/g, '<br>')}</div>
                    </div>
                `;

            } catch (error) {
                showStatus('Erreur: ' + error.message, 'error');
            }
        }

        function analyzeTeamStrengths() {
            const positionSkills = {
                'gardien': ['tir', 'placement'],
                'defenseur': ['defense', 'tacle', 'tete'],
                'milieu': ['passe', 'vision', 'dribble'],
                'attaquant': ['tir', 'vitesse', 'dribble']
            };

            const strengths = {};
            Object.keys(positionSkills).forEach(position => {
                const positionPlayers = players.filter(p => p.position === position);
                if (positionPlayers.length > 0) {
                    strengths[position] = positionSkills[position].map(skill => {
                        const avg = positionPlayers.reduce((sum, player) => sum + player.skills[skill], 0) / positionPlayers.length;
                        return { skill, average: Math.round(avg) };
                    });
                }
            });

            return strengths;
        }

        // G√âN√âRATION D'IMAGES TACTIQUES AVEC IA
        async function generateTacticalImage() {
            const formation = document.getElementById('formation-select').value;
            const style = document.getElementById('style-select').value;
            const instructions = document.getElementById('tactical-instructions').value;
            
            const apiKey = getApiKey();
            if (!apiKey) {
                showStatus('Veuillez configurer l\'API OpenAI d\'abord', 'error', 'image-generation-status');
                return;
            }

            // Afficher le loading
            showImageLoading(true);
            showStatus('G√©n√©ration de l\'image tactique en cours...', 'success', 'image-generation-status');

            try {
                const prompt = createTacticalImagePrompt(formation, style, instructions);
                
                // Utiliser l'API DALL-E pour g√©n√©rer l'image
                const imageUrl = await generateImageWithDalle(prompt);
                
                // Afficher l'image g√©n√©r√©e
                displayGeneratedImage(imageUrl, formation, style, instructions);
                
                showStatus('‚úÖ Image tactique g√©n√©r√©e avec succ√®s!', 'success', 'image-generation-status');
                
            } catch (error) {
                showStatus('‚ùå Erreur lors de la g√©n√©ration: ' + error.message, 'error', 'image-generation-status');
                showImageLoading(false);
            }
        }

        // Fonction pour cr√©er le prompt d√©taill√©
        function createTacticalImagePrompt(formation, style, instructions) {
            const styleDescriptions = {
                'attacking': 'style de jeu offensif avec pressing haut, mouvements agressifs vers l avant',
                'possession': 'jeu de possession avec passes courtes, triangles et maintien du ballon',
                'counter': 'contre-attaque rapide avec transitions d√©fense-attaque rapides',
                'defensive': 'formation d√©fensive solide avec bloc bas et organisation serr√©e',
                'pressing': 'pressing intense sur tout le terrain avec r√©cup√©ration haute'
            };

            const formationNames = {
                '4-3-3': 'formation 4-3-3 avec 4 d√©fenseurs, 3 milieux et 3 attaquants',
                '4-4-2': 'formation 4-4-2 classique avec 4 d√©fenseurs, 4 milieux et 2 attaquants',
                '4-2-3-1': 'formation 4-2-3-1 moderne avec double pivot d√©fensif',
                '3-5-2': 'formation 3-5-2 avec 3 d√©fenseurs et 5 milieux pour le contr√¥le',
                '5-3-2': 'formation 5-3-2 d√©fensive avec 5 d√©fenseurs',
                '4-1-4-1': 'formation 4-1-4-1 pour la possession avec un milieu axial'
            };

            return `Cr√©e un diagramme tactique football professionnel en style vectoriel propre et moderne.

FORMATION: ${formationNames[formation]}
STYLE: ${styleDescriptions[style]}
INSTRUCTIONS: ${instructions}

CARACT√âRISTIQUES VISUELLES:
- Style: diagramme vectoriel professionnel, √©pur√©
- Couleurs: vert terrain, blanc pour les lignes, couleurs distinctes pour chaque position
- √âl√©ments: positions des joueurs num√©rot√©es, fl√®ches de mouvement, zones de jeu
- L√©gende: inclure une l√©gende explicative
- Qualit√©: image haute r√©solution, style coaching professionnel

EXIGENCES:
- Montrer clairement la formation ${formation}
- Illustrer le style de jeu: ${styleDescriptions[style]}
- Inclure les mouvements tactiques principaux
- Ajouter des annotations professionnelles
- Style moderne et lisible pour l'analyse tactique`;
        }

        // G√©n√©ration d'image avec DALL-E
        async function generateImageWithDalle(prompt) {
            const apiKey = getApiKey();
            
            const response = await fetch('https://api.openai.com/v1/images/generations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "dall-e-3",
                    prompt: prompt,
                    size: "1024x1024",
                    quality: "standard",
                    n: 1
                })
            });

            if (!response.ok) {
                throw new Error(`Erreur API DALL-E: ${response.status}`);
            }

            const data = await response.json();
            return data.data[0].url;
        }

        // Affichage de l'image g√©n√©r√©e
        function displayGeneratedImage(imageUrl, formation, style, instructions) {
            const img = document.getElementById('generated-tactical-image');
            const placeholder = document.getElementById('image-placeholder');
            const infoDiv = document.getElementById('image-info');
            const detailsDiv = document.getElementById('tactical-details');
            
            img.onload = function() {
                showImageLoading(false);
                img.style.display = 'block';
                placeholder.style.display = 'none';
                infoDiv.style.display = 'block';
                
                // Sauvegarder l'image courante
                currentGeneratedImage = {
                    url: imageUrl,
                    formation: formation,
                    style: style,
                    instructions: instructions,
                    timestamp: new Date().toISOString()
                };
                
                imageGenerationHistory.push(currentGeneratedImage);
                
                // Mettre √† jour les informations tactiques
                updateTacticalDetails(formation, style, instructions);
            };
            
            img.onerror = function() {
                showImageLoading(false);
                showStatus('Erreur de chargement de l\'image', 'error', 'image-generation-status');
            };
            
            img.src = imageUrl;
        }

        // Mise √† jour des d√©tails tactiques
        function updateTacticalDetails(formation, style, instructions) {
            const detailsDiv = document.getElementById('tactical-details');
            
            const styleIcons = {
                'attacking': '‚öΩ',
                'possession': 'üîÑ',
                'counter': 'üöÄ',
                'defensive': 'üõ°Ô∏è',
                'pressing': 'üéØ'
            };
            
            detailsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;">
                    <div><strong>Formation:</strong> ${formation}</div>
                    <div><strong>Style:</strong> ${styleIcons[style]} ${style}</div>
                </div>
                ${instructions ? `<div><strong>Instructions:</strong> ${instructions}</div>` : ''}
                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #666;">
                    G√©n√©r√© le ${new Date().toLocaleString()}
                </div>
            `;
        }

        // Am√©lioration de l'image existante
        async function enhanceTacticalImage() {
            if (!currentGeneratedImage) {
                showStatus('Aucune image √† am√©liorer', 'error', 'image-generation-status');
                return;
            }

            showImageLoading(true);
            showStatus('Am√©lioration de l\'image en cours...', 'success', 'image-generation-status');

            try {
                const enhancePrompt = `Am√©liore cette image tactique football en ajoutant:
                - Plus de d√©tails sur les mouvements des joueurs
                - Des annotations tactiques avanc√©es
                - Des zones de pressing et de contre-pressing
                - Des sch√©mas de passes et de d√©placements
                - Un style plus professionnel et d√©taill√©
                
                Formation: ${currentGeneratedImage.formation}
                Style: ${currentGeneratedImage.style}
                Instructions originales: ${currentGeneratedImage.instructions}`;

                const enhancedImageUrl = await generateImageWithDalle(enhancePrompt);
                displayGeneratedImage(enhancedImageUrl, currentGeneratedImage.formation, currentGeneratedImage.style, currentGeneratedImage.instructions + " (am√©lior√©)");
                
                showStatus('‚úÖ Image am√©lior√©e avec succ√®s!', 'success', 'image-generation-status');
                
            } catch (error) {
                showStatus('‚ùå Erreur lors de l\'am√©lioration: ' + error.message, 'error', 'image-generation-status');
                showImageLoading(false);
            }
        }

        // T√©l√©chargement de l'image
        async function downloadTacticalImage() {
            if (!currentGeneratedImage) {
                showStatus('Aucune image √† t√©l√©charger', 'error');
                return;
            }

            try {
                const response = await fetch(currentGeneratedImage.url);
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `plan-tactique-${currentGeneratedImage.formation}-${Date.now()}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showStatus('‚úÖ Image t√©l√©charg√©e avec succ√®s!', 'success');
            } catch (error) {
                showStatus('‚ùå Erreur lors du t√©l√©chargement', 'error');
            }
        }

        // Analyse de l'image avec IA
        async function analyzeTacticalImage() {
            if (!currentGeneratedImage) {
                showStatus('Aucune image √† analyser', 'error');
                return;
            }

            showStatus('Analyse tactique en cours...', 'success');

            try {
                const analysisPrompt = `Analyse cette image de diagramme tactique football et fournis une analyse d√©taill√©e:
                
                Formation: ${currentGeneratedImage.formation}
                Style: ${currentGeneratedImage.style}
                
                Points √† analyser:
                1. Points forts de cette formation
                2. Faiblesses potentielles
                3. Mouvements tactiques visibles
                4. Recommandations d'am√©lioration
                5. Adaptations possibles selon l'adversaire`;

                const analysis = await callOpenAI([
                    { role: "user", content: analysisPrompt }
                ]);

                document.getElementById('tactical-details').innerHTML += `
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #ddd;">
                        <h6 style="color: #1a472a; margin-bottom: 0.5rem;">üìà Analyse IA:</h6>
                        <div style="font-size: 0.9rem; line-height: 1.4;">${analysis.replace(/\n/g, '<br>')}</div>
                    </div>
                `;

                showStatus('‚úÖ Analyse termin√©e!', 'success');
            } catch (error) {
                showStatus('‚ùå Erreur lors de l\'analyse', 'error');
            }
        }

        // R√©g√©n√©ration de l'image
        function regenerateTacticalImage() {
            if (currentGeneratedImage) {
                generateTacticalImage();
            }
        }

        // Effacer l'image
        function clearTacticalImage() {
            const img = document.getElementById('generated-tactical-image');
            const placeholder = document.getElementById('image-placeholder');
            const infoDiv = document.getElementById('image-info');
            
            img.style.display = 'none';
            placeholder.style.display = 'block';
            infoDiv.style.display = 'none';
            currentGeneratedImage = null;
            
            showStatus('Image effac√©e', 'success');
        }

        // Gestion du loading
        function showImageLoading(show) {
            const loadingDiv = document.getElementById('image-loading');
            loadingDiv.style.display = show ? 'flex' : 'none';
        }

        // Gestion de l'API OpenAI
        function getApiKey() {
            return localStorage.getItem(API_KEY_STORAGE) || document.getElementById('api-key').value;
        }

        async function callOpenAI(messages, temperature = 0.7) {
            const apiKey = getApiKey();
            if (!apiKey) {
                throw new Error('Cl√© API non configur√©e');
            }

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: messages,
                    temperature: temperature,
                    max_tokens: 2000
                })
            });

            if (!response.ok) {
                throw new Error(`Erreur API: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // Chatbot IA
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage(message, 'user');
            input.value = '';
            
            await generateAIResponse(message);
        }

        async function generateAIResponse(userMessage) {
            const messagesContainer = document.getElementById('chat-messages');
            
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.innerHTML = `
                <div class="message-avatar">ü§ñ</div>
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            try {
                const teamData = {
                    players: players.length,
                    matches: matches.length,
                    recentForm: matches.slice(-3).map(m => m.result)
                };

                const prompt = `Tu es un expert en tactique footballistique. 
                Utilise les donn√©es suivantes pour r√©pondre de mani√®re pertinente:
                Donn√©es actuelles: ${JSON.stringify(teamData)}
                
                Question: ${userMessage}
                
                Sois concret, propose des solutions tactiques et des conseils actionnables.`;

                const response = await callOpenAI([
                    { role: "user", content: prompt }
                ]);
                
                messagesContainer.removeChild(typingDiv);
                addMessage(response, 'bot');
                
            } catch (error) {
                messagesContainer.removeChild(typingDiv);
                addMessage("D√©sol√©, je rencontre des difficult√©s techniques. V√©rifiez votre connexion API.", 'bot');
            }
        }

        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'user' ? 'üë§' : 'ü§ñ';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.innerHTML = content.replace(/\n/g, '<br>');
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            messagesContainer.appendChild(messageDiv);
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function handleChatInput(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Configuration API
        function saveApiKey() {
            const apiKey = document.getElementById('api-key').value;
            if (apiKey) {
                localStorage.setItem(API_KEY_STORAGE, apiKey);
                showStatus('Cl√© API sauvegard√©e avec succ√®s!', 'success');
            } else {
                showStatus('Veuillez entrer une cl√© API valide', 'error');
            }
        }

        async function testApiKey() {
            const apiKey = getApiKey();
            if (!apiKey) {
                showStatus('Veuillez d\'abord entrer une cl√© API', 'error');
                return;
            }

            showStatus('Test de connexion en cours...', 'success');
            
            try {
                const response = await callOpenAI([
                    { role: "user", content: "R√©ponds simplement 'OK' pour confirmer la connexion." }
                ]);
                
                if (response) {
                    showStatus('‚úÖ Connexion √† l\'API OpenAI r√©ussie!', 'success');
                }
            } catch (error) {
                showStatus('‚ùå Erreur de connexion: ' + error.message, 'error');
            }
        }

        function clearApiKey() {
            localStorage.removeItem(API_KEY_STORAGE);
            document.getElementById('api-key').value = '';
            showStatus('Cl√© API effac√©e', 'success');
        }

        function showStatus(message, type, elementId = 'api-status') {
            const statusEl = document.getElementById(elementId);
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        // Sauvegarde des donn√©es
        function savePlayers() {
            localStorage.setItem('football_players', JSON.stringify(players));
        }

        function saveMatches() {
            localStorage.setItem('football_matches', JSON.stringify(matches));
        }

        function saveTrainings() {
            localStorage.setItem('football_trainings', JSON.stringify(trainings));
        }

        // Exportation des fonctions globales
        window.showPage = showPage;
        window.toggleMobileMenu = toggleMobileMenu;
        window.addPlayer = addPlayer;
        window.deletePlayer = deletePlayer;
        window.addMatch = addMatch;
        window.addTraining = addTraining;
        window.loadPlayerStats = loadPlayerStats;
        window.analyzeTactics = analyzeTactics;
        window.generateLineup = generateLineup;
        window.analyzeOpponent = analyzeOpponent;
        window.generateTacticalImage = generateTacticalImage;
        window.enhanceTacticalImage = enhanceTacticalImage;
        window.downloadTacticalImage = downloadTacticalImage;
        window.analyzeTacticalImage = analyzeTacticalImage;
        window.regenerateTacticalImage = regenerateTacticalImage;
        window.clearTacticalImage = clearTacticalImage;
        window.sendMessage = sendMessage;
        window.handleChatInput = handleChatInput;
        window.saveApiKey = saveApiKey;
        window.testApiKey = testApiKey;
        window.clearApiKey = clearApiKey;

        console.log('Coach Boot Football initialis√© avec g√©n√©rateur d\'images IA!');
    </script>
</body>
</html>